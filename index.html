<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"
        type="application/javascript"></script>
</head>
<style>
    *{
        margin: 0;
        padding: 0;
        
    }
    body{
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
        background-color: rgb(31, 31, 31);
        color: white;
    }
    #connect_wallet{
        width: 200px;
        height: 30px;
        background-color: white;
        padding: 13px 20px ;
        color: gray;
        font-size: 18px;
        text-decoration: none;
        font-weight: 800;
        border: 2px solid rgb(4, 121, 255);
        border-radius: 30px;
        text-align: center;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
    }
    p{
        font-size: 20px;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        font-weight: 600;
        margin: 20px 0 10px 0 ;
    }
    #cards{
        display: flex;
        justify-content: center;
        max-width: 1130px;
        flex-wrap: wrap;
    }
    #cards>li{
        width: 400px;
        height: auto;
        list-style: none;
        background-color: rgb(202, 202, 202);
        padding: 10px;
        margin-left: 10px;
        margin-top: 20px;
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        color: black;
    }
    #cards>li>img{
        width: 100%;
        height: 270px;
    }
    #cards>li>video{
        width: 100%;
        height: 270px;
    }
    #cards>li>h2{
        font-size: 28px;
    }
</style>
<body>

    <a href="#" id="connect_wallet">Connect Metamask</a>
    <p id="acc"></p>
    <p id="acc_balance"></p>
    <p id="blockNumber"></p>
    <p id="total"></p>
    <ul id="cards">
    </ul>
</body>
<script>
const btn_wallet = document.getElementById("connect_wallet")
      accaddress = document.getElementById("acc")
      acc_balance = document.getElementById("acc_balance")
      block = document.getElementById("blockNumber")
      list = document.getElementById("list")
      total = document.getElementById("total")
      cards = document.getElementById("cards");
btn_wallet.addEventListener("click", async()=>{
        if(window.ethereum){
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            
            // metamask ni tasdiqlash uchun oynani ochish
            await provider.send("eth_requestAccounts", []);
            //royhatdan otgan bolsa
            const signer = await provider.getSigner();
            
            //address metamask olish
            const addressMeta = await signer.getAddress(); 
            // balance olish
            const balance = await signer.getBalance();
            //block raqamini olish
            const blockNumber = await provider.getBlockNumber();
            //nftni olish//
                const response = await fetch(`https://api.rarible.org/v0.1/items/byOwner/?owner=ETHEREUM:${addressMeta}`);
                const data = await response.json();
                console.log(data)
                accaddress.innerText =`Account: ${addressMeta}`;
                 acc_balance.innerText = `Balance: ${ethers.utils.formatEther(balance)}`;
                 block.innerText = `Block Number: ${blockNumber}`;
                 total.innerText = `NFT total: ${data.total}`;
                for(let i = 0; i < data.total; i++){
                    let image = data.items[i].meta.content[0].url;
                    let name = data.items[i].meta.name;
                    let card = document.createElement('li');
                    if(data.items[i].meta.content[0].mimeType =='video/mp4'){
                        let cardvideo = document.createElement("video");
                        let cardSource = document.createElement("source");
                        cardSource.setAttribute("src", image);
                        cardvideo.setAttribute("controls", "controls");
                    
                        cardvideo.appendChild(cardSource)
                        card.appendChild(cardvideo);
                    }
                    else if(data.items[i].meta.content[0].mimeType == 'image/png' || data.items[i].meta.content[0].mimeType == 'image/jpg'){
                        let cardimg = document.createElement("img");
                        cardimg.setAttribute("src", image);
                        card.appendChild(cardimg);
                    }
                   
                
                    
                    let h2 = document.createElement('h2');
                    h2.innerText = name;
                    card.appendChild(h2);

                    let description = data.items[i].meta.description;
                    let desc = document.createElement("p");
                    desc.innerText = 'description: '+description;
                    card.appendChild(desc)
                    let representationget= data.items[i].meta.content[0].representation;
                    let representationRender = document.createElement("p");
                    representationRender.innerText = `representation: ${representationget}`;
                    card.appendChild(representationRender)
                    cards.appendChild(card);
                }
            }else{
                 btn_wallet.innerText = "Metamask install"
            }
});
    
</script>
</html>